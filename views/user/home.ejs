<%- include('../layouts/userLayouts/header') %>
    <%- include('../layouts/userLayouts/navbar1') %>
        <main class="main">
            <style>
                .pagination-area {
                display: flex;
                justify-content: center;
                margin: 30px 0;
            }
            
            .pagination {
                display: flex;
                gap: 5px; 
            }
            
            .page-item {
                margin: 0 2px;
            }
   
                 .product-img-action-wrap {
                position: relative;
                    }

            .heart-icon {
                position: absolute;
                top: 9px;
                right: 10px;
                z-index: 10;
                background-color: rgba(255, 255, 255, 0.8);
                border-radius: 50%;
                width: 40px; 
                height: 40px; 
                display: flex; 
                align-items: center; 
                justify-content: center; 
            }

        .product-cart-wrap {
         border: none;
        box-shadow: none; 
       }
                            
      .product-cart-wrap:hover {
        box-shadow: none; 
       }

               
           
            </style>
            <section class="product-tabs section-padding position-relative wow fadeIn animated">
                <div class="bg-square"></div>
                <div class="container">
                    <div class="tab-content wow fadeIn animated" id="myTabContent">
                        <div class="tab-pane fade show active" id="tab-one" role="tabpanel" aria-labelledby="tab-one">
                            <div class="container mt-5">
                                <div class="tab-pane fade show active" id="tab-one" role="tabpanel"
                                    aria-labelledby="tab-one">
                                    <% if (productsArray.length === 0) { %>
                                        <div class="text-center">
                                            <h3>No Products Found Yet</h3>
                                        </div>
                                    <% } else { %>
                                    <div class="row product-grid-5">
                                        <% for(let i=0; i < productsArray.length; i++) { %>
                                            <div class="col-lg-2-4 col-md-3 col-6 col-sm-4">
                                                <div class="product-cart-wrap mb-30">
                                                    <div class="product-img-action-wrap">
                                                        <div class="product-img product-img-zoom">
                                                            <a href="/productDetails?id=<%= productsArray[i]._id %>">
                                                                <img class="default-img"
                                                                    src="/productImages/<%= productsArray[i]?.images[0]?.filename %>"
                                                                    alt="">
                                                                    <% for (let j = 1; j < productsArray[i].images.length; j++) { %>
                                                                        <img class="hover-img" src="/productImages/<%= productsArray[i].images[j]?.filename %>" alt="Product Image">
                                                                    <% } %>
                                                            </a>
                                                        </div>
                                                
                                                        <div class="heart-icon" data-id="<%=productsArray[i]?._id%>">

                                                            <div class="wishlist-toggle" aria-label="Add to Wishlist">
                                                                <svg xmlns="http://www.w3.org/2000/svg" width="20"
                                                                    height="20" viewBox="0 0 24 24" fill="none"
                                                                    stroke="currentColor" stroke-width="2"
                                                                    stroke-linecap="round" stroke-linejoin="round">
                                                                    <path
                                                                        d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z">
                                                                    </path>
                                                                </svg>
                                                            </div>
    
    
                                                        </div>
                                                     
                       
                                                    </div>
                                                    <div class="product-content-wrap">
                                                        <div class="product-category">
                                                            <a  class="h4">
                                                                <%= productsArray[i].brand.name %>
                                                            </a>
                                                        </div>
                                                        <h5 style="  overflow: hidden;
                                                        text-overflow: ellipsis;
                                                        white-space: nowrap;"><a href="/productDetails?id=<%= productsArray[i]._id %>">
                                                                <%= productsArray[i].name %>
                                                            </a></h5>
                                                        <div class="rating-result" title="90%">
                                                            <% if (productsArray[i]?.productOffer && productsArray[i]?.productOffer?.offerDiscountPercentage&&new Date(productsArray[i]?.productOffer?.offerExpiryDate) > new Date()&&productsArray[i]?.productSalesPriceAfterOfferDiscount!==0&&productsArray[i]?.productOffer?.offerStatus) { %>
                                                                <span>
                                                                    <span><%= productsArray[i]?.productOffer?.offerDiscountPercentage %> % </span>
                                                                </span>
                                                            <% } else { %>
                                                                <!-- <span>90%</span> -->
                                                            <% } %>
                                                        </div>
                                                        <div class="product-price">
                                                            <%if(productsArray[i].isBlocked || productsArray[i].category?.isBlocked||productsArray?.isBlocked) { %>

                                                                
                                                                <span style="color: red;">Currently Unavailable</span>
                                                                <%} else { %>
                                                                    <% if (productsArray[i]?.productSalesPriceAfterOfferDiscount  && new Date(productsArray[i]?.productOffer?.offerExpiryDate) > new Date()&&productsArray[i]?.productSalesPriceAfterOfferDiscount !==0 && productsArray[i]?.productOffer?.offerStatus) { %>

                                                                        <span>₹ <%= productsArray[i].productSalesPriceAfterOfferDiscount %></span>

                                                                        <% } else { %>

                                                                        <span>₹ <%=productsArray[i].salesPrice %></span>
                                                                        
                                                                    <% } %>
                                                                    
                                                            <% } %>
                                                        </div>
                                                       
                                                    </div>

                                                </div>
                                            </div>
                                            <% } %>
                                    </div>
                                    <% } %>
                                </div>

                                
                                <div class="pagination-area mt-30 mb-50 text-center">
                                    <nav aria-label="Page navigation example">
                                        <ul class="pagination justify-content-start">
                                            <% if (currentPage > 1) { %>
                                                <li class="page-item">
                                                    <a class="page-link" href="?page=<%= currentPage - 1 %>">
                                                        <strong>&lt;</strong>
                                                    </a>
                                                </li>
                                            <% } %>
                                            
                                            <% 
                                            let startPage = Math.max(1, currentPage - 2);
                                            let endPage = Math.min(totalPages, startPage + 4);
                                            if (endPage - startPage < 4) {
                                                startPage = Math.max(1, endPage - 4);
                                            }
                                            %>
                                            
                                            <% for (let i = startPage; i <= endPage; i++) { %>
                                                <li class="page-item <%= i === currentPage ? 'active' : '' %>">
                                                    <a class="page-link" href="?page=<%= i %>"><strong><%= i %></strong></a>
                                                </li>
                                            <% } %>
                                            
                                            <% if (currentPage < totalPages) { %>
                                                <li class="page-item">
                                                    <a class="page-link" href="?page=<%= currentPage + 1 %>">
                                                        <strong>&gt;</strong>
                                                    </a>
                                                </li>
                                            <% } %>
                                        </ul>
                                    </nav>
                                </div>



                            </div>
                          
                        </div>
                       
                    </div>
                 
                </div>
            </section>


        </main>

        <script>
             document.addEventListener('DOMContentLoaded', () => {
        
            let successMessage = '<%= successMessage %>';

            if (successMessage) {
                Swal.fire({
                    text: successMessage,
                    icon: 'success',
                    toast: true,
                    position: 'top-right',
                    showConfirmButton: false,
                    timerProgressBar: true,
                    timer: 3000
                });
            }
        });
       

        </script>
        <%- include('../layouts/userLayouts/footer') %>