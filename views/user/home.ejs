<%- include('../layouts/userLayouts/header') %>
    <%- include('../layouts/userLayouts/navbar1') %>
        <main class="main">
            <style>
                .pagination-area {
                display: flex;
                justify-content: center;
                margin: 30px 0;
            }
            
            .pagination {
                display: flex;
                gap: 5px; 
            }
            
            .page-item {
                margin: 0 2px;
            }
            
            </style>
            <section class="product-tabs section-padding position-relative wow fadeIn animated">
                <div class="bg-square"></div>
                <div class="container">
                    <div class="tab-content wow fadeIn animated" id="myTabContent">
                        <div class="tab-pane fade show active" id="tab-one" role="tabpanel" aria-labelledby="tab-one">
                            <div class="container mt-5">
                                <div class="tab-pane fade show active" id="tab-one" role="tabpanel"
                                    aria-labelledby="tab-one">
                                    <% if (productsArray.length === 0) { %>
                                        <div class="text-center">
                                            <h3>No Products Found Yet</h3>
                                        </div>
                                    <% } else { %>
                                    <div class="row product-grid-5">
                                        <% for(let i=0; i < productsArray.length; i++) { %>
                                            <div class="col-lg-2-4 col-md-3 col-6 col-sm-4">
                                                <div class="product-cart-wrap mb-30">
                                                    <div class="product-img-action-wrap">
                                                        <div class="product-img product-img-zoom">
                                                            <a href="/productDetails?id=<%= productsArray[i]._id %>">
                                                                <img class="default-img"
                                                                    src="/productImages/<%= productsArray[i]?.images[0]?.filename %>"
                                                                    alt="">
                                                            </a>
                                                        </div>
                                                
                                                        <div class="product-action-1">

                                                            <a aria-label="Add To Wishlist"
                                                                class="action-btn hover-up"><i
                                                                    class="fi-rs-heart"></i></a>
                                                        </div>
                                                        
                                                     
                       
                                                    </div>
                                                    <div class="product-content-wrap">
                                                        <div class="product-category">
                                                            <a  class="h4">
                                                                <%= productsArray[i].brand.name %>
                                                            </a>
                                                        </div>
                                                        <h5 style="  overflow: hidden;
                                                        text-overflow: ellipsis;
                                                        white-space: nowrap;"><a href="/productDetails?id=<%= productsArray[i]._id %>">
                                                                <%= productsArray[i].name %>
                                                            </a></h5>
                                                        <div class="rating-result" title="90%">
                                                            <span>
                                                                <span>90%</span>
                                                            </span>
                                                        </div>
                                                        <div class="product-price">
                                                            <%if(productsArray[i].isBlocked || productsArray[i].category?.isBlocked||productsArray?.isBlocked) { %>

                                                                
                                                                <span style="color: red;">Currently Unavailable</span>
                                                                <%} else { %>
                                                            <span>â‚¹ <%= productsArray[i].salesPrice %> </span>
                                                            <span class="old-price">
                                                                <%= productsArray[i].regularPrice %>
                                                            </span>
                                                            <% } %>
                                                        </div>
                                                       
                                                    </div>

                                                </div>
                                            </div>
                                            <% } %>
                                    </div>
                                    <% } %>
                                </div>

                                
                                <div class="pagination-area mt-30 mb-50 text-center">
                                    <nav aria-label="Page navigation example">
                                        <ul class="pagination justify-content-start">
                                            <% if (currentPage > 1) { %>
                                                <li class="page-item">
                                                    <a class="page-link" href="?page=<%= currentPage - 1 %>">
                                                        <strong>&lt;</strong>
                                                    </a>
                                                </li>
                                            <% } %>
                                            
                                            <% 
                                            let startPage = Math.max(1, currentPage - 2);
                                            let endPage = Math.min(totalPages, startPage + 4);
                                            if (endPage - startPage < 4) {
                                                startPage = Math.max(1, endPage - 4);
                                            }
                                            %>
                                            
                                            <% for (let i = startPage; i <= endPage; i++) { %>
                                                <li class="page-item <%= i === currentPage ? 'active' : '' %>">
                                                    <a class="page-link" href="?page=<%= i %>"><strong><%= i %></strong></a>
                                                </li>
                                            <% } %>
                                            
                                            <% if (currentPage < totalPages) { %>
                                                <li class="page-item">
                                                    <a class="page-link" href="?page=<%= currentPage + 1 %>">
                                                        <strong>&gt;</strong>
                                                    </a>
                                                </li>
                                            <% } %>
                                        </ul>
                                    </nav>
                                </div>



                            </div>
                          
                        </div>
                       
                    </div>
                 
                </div>
            </section>


        </main>

        <script>
             document.addEventListener('DOMContentLoaded', () => {
        
            let successMessage = '<%= successMessage %>';

            if (successMessage) {
                Swal.fire({
                    text: successMessage,
                    icon: 'success',
                    toast: true,
                    position: 'top-right',
                    showConfirmButton: false,
                    timerProgressBar: true,
                    timer: 3000
                });
            }
        });
       

        </script>
        <%- include('../layouts/userLayouts/footer') %>