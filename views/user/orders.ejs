<%- include('../layouts/userLayouts/header') %>
<div class="bg-white sticky-top">
  <!-- Navbar -->
  <nav class="navbar navbar-expand-lg navbar-light bg-white">
    <div class="container">
      <!-- Logo with Dummy Image -->
      <a class="navbar-brand d-flex align-items-center" href="">
        <span style="font-size: 32px; font-weight: bold; color: black"
          >AXIOS</span
        ><sup style="color: black">Â®</sup>
      </a>
      <!-- Search Form -->
      <form
        class="d-flex mx-auto w-50"
        id="searchForm"
        action="/showcase"
        method="GET"
      >
        <input
          class="form-control search-bar"
          style="
            border: none;
            box-shadow: 0px 0px 6px rgba(0, 0, 0, 0.3);

            padding: 20px 15px;
            border-radius: 5px;
            height: 48px;
          "
          type="search"
          name="searchProduct"
          placeholder="Search for items..."
          aria-label="Search"
          value="<%= searchProduct || '' %>"
        />
      </form>

      <!-- Icons -->
      <ul
        style="margin-right: 10px"
        class="navbar-nav mb-2 mb-lg-0 d-flex align-items-center"
      >
        <li class="nav-item me-3">
          <a
            class="nav-link"
            href="/wishlist"
            style="color: black; font-weight: bold; font-size: 24px"
          >
            <i class="fi-rs-heart"></i>
          </a>
        </li>
        <li class="nav-item me-3">
          <a
            class="nav-link"
            href="/cart"
            style="color: black; font-weight: bold; font-size: 24px"
          >
            <i class="fi-rs-shopping-cart"></i>
          </a>
        </li>
        <li class="nav-item me-3">
          <a
            class="nav-link"
            href="/profile"
            style="color: black; font-weight: bold; font-size: 24px"
          >
            <i class="fi-rs-user"></i>
          </a>
        </li>
      </ul>
    </div>
  </nav>

  <div class="container" style="height: 70px">
    <div class="row">
      <div class="col-12 text-center mt-3">
        <ul style="user-select: none" class="list-inline">
          <li class="list-inline-item">
            <a
              href="/showcase?targetGroup=men"
              style="
                color: black;
                font-weight: bold;
                font-size: 20px;
                padding-right: 10px;
              "
              >Mens</a
            >
          </li>
          <li class="list-inline-item">
            <a
              href="/showcase?targetGroup=women"
              style="
                color: black;
                font-weight: bold;
                font-size: 20px;
                padding-right: 10px;
              "
              >Womens</a
            >
          </li>
          <li class="list-inline-item">
            <a
              href="/showcase?targetGroup=kids"
              style="
                color: black;
                font-weight: bold;
                font-size: 20px;
                padding-right: 10px;
              "
              >Kids</a
            >
          </li>
          <li class="list-inline-item">
            <a
              href="/"
              style="
                color: black;
                font-weight: bold;
                font-size: 20px;
                padding-right: 10px;
              "
              >About Us</a
            >
          </li>
          <li class="list-inline-item">
            <a
              href="/"
              style="
                color: black;
                font-weight: bold;
                font-size: 20px;
                padding-right: 10px;
              "
              >Contact</a
            >
          </li>
        </ul>
      </div>
    </div>
  </div>
</div>

<div
  class="page-header breadcrumb-wrap"
  style="
    background-color: transparent;
    padding: 15px 0;
    font-family: Arial, sans-serif;
  "
>
  <div class="container" style="max-width: 1200px; margin: 0 auto">
    <div class="breadcrumb" style="font-size: 16px; color: #6c757d">
      <a
        href="/"
        rel="nofollow"
        style="color: rgb(34, 33, 33); text-decoration: none; margin-right: 8px"
        >Home</a
      >
      <span style="margin: 0 8px; color: #6c757d"></span>
      <!-- More modern separator -->
      <a href="/orders?view=orders" style="color: rgb(34, 33, 33); text-decoration: none">
        Orders
      </a>
    </div>
  </div>
</div>
<main class="main">
  <section style="padding-top: 100px; padding-bottom: 100px">
    <div class="container">
      <div class="row">
        <div class="col-lg-10 m-auto">
          <div class="row">
            <%- include('../layouts/userLayouts/sidebar') %>
            <div class="col-md-8">
              <div class="container mt-3">
                <h2
                  class="h2"
                  style="
                    font-size: 24px;
                    font-weight: bold;
                    color: #333;
                    margin-bottom: 1rem;
                  "
                >
                  MANAGE YOUR ORDERS
                </h2>

                <% if (orderData && orderData.length > 0) { %> <%
                orderData.forEach(order => { %>
                <div
                  class="order-card card mb-3"
                  style="border-radius: 10px"
                  data-order-id="<%= order._id %>"
                >
                  <div class="card-body">
                    <div class="row">
                      <div class="col-12 col-md-6">
                        <p class="mb-1">
                          <strong>Order Number:</strong> #<%= order._id %>
                        </p>
                        <p class="mb-1">
                          <strong>Total:</strong> Rs <%= order.totalAmount %>
                        </p>
                        <p class="mb-1">
                          <strong>Order Date:</strong> <%= new
                          Date(order.orderDate).toLocaleDateString() %>
                        </p>
                        <p class="mb-1">
                          <strong>Payment Method:</strong> <%=
                          order.paymentMethod %>
                        </p>
                        <p class="mb-1">
                          <strong>Online Payment Status:</strong> <%=
                          order.transaction.paymentStatus || 'N/A' %>
                        </p>
                      </div>
                      <div
                        class="col-12 col-md-3 text-md-right text-warning my-2"
                      >
                        <strong><%= order.orderStatus.toUpperCase() %></strong>
                      </div>
                      <div class="col-12 col-md-3 text-md-right">
                        <% if (order.transaction.paymentStatus === 'failed' ||
                        order.transaction.paymentStatus === 'pending') { %>
                        <form
                          action="/retryPayment"
                          method="GET"
                          class="d-inline"
                        >
                          <input
                            type="hidden"
                            name="orderId"
                            value="<%= order._id %>"
                          />
                          <button
                            type="submit"
                            class="btn btn-primary btn-sm mb-2"
                          >
                            Retry
                          </button>
                        </form>
                        <% } %>
                        <!-- Form for viewing order details -->
                        <a
                          href="/orders/<%= order._id %>?view=details"
                          class="d-inline"
                        >
                          <button
                            type="button"
                            class="btn btn-secondary btn-sm"
                          >
                            View Details
                          </button>
                        </a>
                      </div>
                    </div>
                  </div>
                </div>
                <% }) %> <% } else { %>
                <p>No orders found.</p>
                <% } %>
              </div>

              <div class="pagination-area mt-30 mb-50">
                <nav aria-label="Page navigation example">
                  <ul class="pagination justify-content-start">
                    <% if (currentPage > 1) { %>
                    <li class="page-item">
                      <a
                        class="page-link"
                        href="/orders?view=orders&page=<%= currentPage - 1 %>"
                      >
                        <strong>&lt;</strong>
                      </a>
                    </li>
                    <% } %> <% let startPage = Math.max(1, currentPage - 2); let
                    endPage = Math.min(totalPages, startPage + 4); if (endPage -
                    startPage < 4) { startPage = Math.max(1, endPage - 4); } %>
                    <% for (let i = startPage; i <= endPage; i++) { %>
                    <li
                      class="page-item <%= i === currentPage ? 'active' : '' %>"
                    >
                      <a
                        class="page-link"
                        href="/orders?view=orders&page=<%= i %>"
                        ><strong><%= i %></strong></a
                      >
                    </li>
                    <% } %> <% if (currentPage < totalPages) { %>
                    <li class="page-item">
                      <a
                        class="page-link"
                        href="/orders?view=orders&page=<%= currentPage + 1 %>"
                      >
                        <strong>&gt;</strong>
                      </a>
                    </li>
                    <% } %>
                  </ul>
                </nav>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </section>
</main>
<%- include('../layouts/userLayouts/footer') %>
